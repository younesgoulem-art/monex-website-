<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تسجيل الدخول - MONEX Academy</title>
  <style>
    :root{
      --gold-1: #f6d365; /* فاتح */
      --gold-2: #f0b429; /* ذهبي */
      --gold-3: #b88700; /* غامق */
      --bg: #fffaf0;
      --muted: #6b6b6b;
      --danger: #d9534f;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing:border-box; margin:0; padding:0}
    html,body{height:100%}
    body{
      background: linear-gradient(180deg, var(--bg) 0%, #fff 60%);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      color:#222;
    }

    .card{
      width:100%;
      max-width:420px;
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.98));
      border-radius:16px;
      box-shadow: 0 10px 30px rgba(18,18,18,0.08);
      padding:26px;
      border: 1px solid rgba(184,135,0,0.08);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:18px;
    }

    .logo{
      width:56px;
      height:56px;
      border-radius:12px;
      background: radial-gradient(circle at 30% 30%, var(--gold-1), var(--gold-2) 45%, var(--gold-3));
      display:flex;
      align-items:center;
      justify-content:center;
      color: #2b2b2b;
      font-weight:700;
      font-size:18px;
      box-shadow: 0 6px 18px rgba(176,137,0,0.12), inset 0 -6px 10px rgba(255,255,255,0.12);
    }

    h1{
      font-size:18px;
      color:#1f1f1f;
      margin-bottom:6px;
    }
    p.subtitle{
      color:var(--muted);
      font-size:13px;
    }

    form{margin-top:18px; display:grid; gap:12px}

    label{font-size:13px; color:#333; margin-bottom:6px; display:block}
    .input{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,0.06);
      background:#fff;
      font-size:15px;
      outline:none;
      transition: box-shadow .14s, border-color .14s;
    }
    .input:focus{
      border-color: rgba(176,137,0,0.7);
      box-shadow: 0 4px 16px rgba(184,135,0,0.06);
    }

    .row{display:flex; gap:10px; align-items:center}
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      background: linear-gradient(90deg, var(--gold-2), var(--gold-3));
      color:#111;
      font-weight:600;
      border:none;
      cursor:pointer;
      box-shadow: 0 8px 22px rgba(184,135,0,0.12);
      transition: transform .06s ease, opacity .12s;
    }
    .btn:active{ transform: translateY(1px) }
    .btn[disabled]{ opacity:0.6; cursor:not-allowed }

    .secondary{
      background: transparent;
      border:1px solid rgba(0,0,0,0.06);
      color:#333;
    }

    .actions{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:4px; font-size:13px; color:var(--muted) }
    a.link{ color:var(--gold-3); text-decoration:none; font-weight:600 }
    a.link:hover{ text-decoration:underline }

    .message{ margin-top:8px; font-size:13px; color:var(--muted) }
    .error{ color:var(--danger); font-size:13px; margin-top:6px }

    .small{
      font-size:12px;
      color:var(--muted);
      text-align:center;
      margin-top:14px;
    }

    footer.note{ margin-top:12px; text-align:center; font-size:12px; color:var(--muted) }

    @media (max-width:480px){
      .card{ padding:18px; border-radius:12px }
      .logo{ width:48px; height:48px; font-size:16px }
    }
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="login-heading">
    <div class="brand">
      <div class="logo" aria-hidden="true">MA</div>
      <div>
        <h1 id="login-heading">MONEX Academy</h1>
        <p class="subtitle">تسجيل دخول لحسابك للوصول للصفحة الرئيسية</p>
      </div>
    </div>

    <form id="loginForm" autocomplete="on" novalidate>
      <div>
        <label for="email">البريد الإلكتروني</label>
        <input id="email" class="input" type="email" inputmode="email" autocomplete="email" required placeholder="you@example.com" />
      </div>

      <div>
        <label for="password">كلمة المرور</label>
        <div style="position:relative">
          <input id="password" class="input" type="password" autocomplete="current-password" required placeholder="••••••••" />
          <button id="togglePwd" type="button" aria-label="إظهار / إخفاء كلمة المرور"
            style="position:absolute; right:8px; top:8px; background:transparent; border:none; cursor:pointer; font-size:13px; color:var(--gold-3)">
            إظهار
          </button>
        </div>
      </div>

      <div class="row">
        <button id="loginBtn" class="btn" type="submit">دخول</button>
        <button id="guestBtn" class="btn secondary" type="button" title="تسجيل مستخدم جديد">تسجيل</button>
      </div>

      <div class="actions">
        <a href="#" id="forgotLink" class="link">نسيت كلمة المرور؟</a>
        <div class="message">تسجيل آمن بواسطة Firebase</div>
      </div>

      <div id="error" class="error" role="status" aria-live="polite" hidden></div>
    </form>

    <div class="small">
      يرجى عدم مشاركة بيانات الدخول. بتسجيلك ستتحول تلقائياً إلى الصفحة الرئيسية.
    </div>

    <footer class="note">
      MONEX Academy • امن المنصة من Firebase
    </footer>
  </main>

  <!-- Firebase + App logic -->
  <script type="module">
    // ---- إعدادات Firebase (استعمل ما أعطيتني)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      sendPasswordResetEmail,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCoyCAdEmG9nSWmYhDTYtzkarNm12LOl5o",
      authDomain: "monex-academ.firebaseapp.com",
      projectId: "monex-academ",
      storageBucket: "monex-academ.appspot.com",
      messagingSenderId: "739982923559",
      appId: "1:739982923559:web:47ebe50822acba14d3fb02",
      measurementId: "G-D7CGRPRKQE"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // عناصر DOM
    const loginForm = document.getElementById('loginForm');
    const emailInput = document.getElementById('email');
    const pwdInput = document.getElementById('password');
    const loginBtn = document.getElementById('loginBtn');
    const guestBtn = document.getElementById('guestBtn');
    const forgotLink = document.getElementById('forgotLink');
    const errorBox = document.getElementById('error');
    const togglePwd = document.getElementById('togglePwd');

    // تحويل تلقائي إن كان المستخدم مسجل (حالة مُسبقة)
    onAuthStateChanged(auth, user => {
      if (user) {
        // بالفعل مسجل → اذهب إلى index.html
        window.location.href = "index.html";
      }
    });

    // إظهار/إخفاء كلمة المرور
    togglePwd.addEventListener('click', () => {
      const type = pwdInput.type === 'password' ? 'text' : 'password';
      pwdInput.type = type;
      togglePwd.textContent = type === 'password' ? 'إظهار' : 'إخفاء';
    });

    function showError(message) {
      errorBox.hidden = false;
      errorBox.textContent = message;
    }
    function clearError() {
      errorBox.hidden = true;
      errorBox.textContent = '';
    }

    // تسجيل الدخول
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearError();

      const email = emailInput.value.trim();
      const password = pwdInput.value;

      if (!email || !password) {
        showError('الرجاء إدخال البريد الإلكتروني وكلمة المرور.');
        return;
      }

      loginBtn.disabled = true;
      loginBtn.textContent = 'جارِ الدخول...';

      try {
        await signInWithEmailAndPassword(auth, email, password);
        // عند نجاح التسجيل، onAuthStateChanged سيحوّل المستخدم تلقائياً إلى index.html
      } catch (err) {
        // أخطاء مفيدة للمستخدم
        if (err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found') {
          showError('الإيميل أو كلمة المرور غير صحيحة.');
        } else if (err.code === 'auth/invalid-email') {
          showError('البريد الإلكتروني غير صالح.');
        } else {
          showError(err.message || 'حصل خطأ أثناء الدخول.');
        }
        loginBtn.disabled = false;
        loginBtn.textContent = 'دخول';
      }
    });

    // زر التسجيل (ينشئ مستخدم جديد) — اختياري، يمكن حذفه اذا ما تحتاجه
    guestBtn.addEventListener('click', async () => {
      clearError();
      const email = emailInput.value.trim();
      const password = pwdInput.value;
      if (!email || !password) {
        showError('أدخل إيميل وكلمة مرور لإنشاء حساب.');
        return;
      }
      guestBtn.disabled = true;
      guestBtn.textContent = 'جارِ التسجيل...';
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        // بعد إنشاء الحساب، onAuthStateChanged سيحوّل المستخدم
      } catch (err) {
        if (err.code === 'auth/email-already-in-use') {
          showError('هذا البريد مُستخدم مسبقًا. جرّب تسجيل الدخول.');
        } else if (err.code === 'auth/weak-password') {
          showError('كلمة المرور ضعيفة. استخدم 6 أحرف على الأقل.');
        } else {
          showError(err.message || 'حصل خطأ أثناء التسجيل.');
        }
        guestBtn.disabled = false;
        guestBtn.textContent = 'تسجيل';
      }
    });

    // رابط نسيت كلمة المرور
    forgotLink.addEventListener('click', async (e) => {
      e.preventDefault();
      clearError();
      const email = emailInput.value.trim();
      if (!email) {
        showError('أدخل بريدًا إلكترونيًا لإرسال رابط إعادة التعيين.');
        return;
      }
      forgotLink.textContent = 'جارِ الإرسال...';
      try {
        await sendPasswordResetEmail(auth, email);
        showError('تم إرسال رابط إعادة التعيين إلى بريدك. تفقد صندوق الوارد.');
      } catch (err) {
        if (err.code === 'auth/user-not-found') {
          showError('لا يوجد حساب مرتبط بهذا البريد.');
        } else {
          showError(err.message || 'حصل خطأ أثناء إرسال الرابط.');
        }
      } finally {
        forgotLink.textContent = 'نسيت كلمة المرور؟';
      }
    });
  </script>
</body>
</html>
